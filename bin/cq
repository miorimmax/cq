#!/bin/sh
# -*- mode: sh -*-

set -euf

find_cq_jar() {
    cq_bin=$1

    cd $(dirname $cq_bin)
    real_cq_bin=$(basename $cq_bin)

    while [ -L $real_cq_bin ]; do
        real_cq_bin=$(readlink $real_cq_bin)
        cd $(dirname $real_cq_bin)
        real_cq_bin=$(basename $real_cq_bin)
    done

    printf "%s/cq.jar" $(pwd -P)
}

CQ_JAR=$(find_cq_jar $0)

# export CQ_JAVA_CMD=drip for faster startup time
CQ_JAVA_CMD="java"

exec ${CQ_JAVA_CMD} -cp ${CQ_JAR} clojure.main -m cq.cli "$@"
